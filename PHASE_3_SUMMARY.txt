================================================================================
                  LUMOS PHASE 3 - IMAGE SUPPORT ANALYSIS
                              EXECUTIVE SUMMARY
================================================================================

DATE: 2025-11-18
STATUS: Phase 2 Complete ✓, Phase 3 Planning
ANALYSIS DOCUMENT: /home/user/LUMOS/PHASE_3_IMAGE_SUPPORT_ANALYSIS.md (876 lines)

================================================================================
1. CURRENT LEDONGTHUC/PDF LIBRARY STATUS
================================================================================

GOOD NEWS:
✓ Fast text extraction
✓ Lightweight (100KB)
✓ Proven in production (94% test coverage)
✓ Simple, focused API

BAD NEWS:
✗ NO image extraction support (HARD BLOCKER)
✗ Only handles text content
✗ No embedded object/stream support

VERDICT: Cannot add image support without switching/supplementing PDF library


================================================================================
2. PDF IMAGE EXTRACTION OPTIONS (RANKED BY RECOMMENDATION)
================================================================================

1️⃣  PDFCPU (RECOMMENDED for Phase 3.1)
   Status: ✓ Production-ready, actively maintained
   License: Apache 2.0 (commercial-friendly)
   Size: +500KB library
   Pros:
   ✓ Full image extraction (JPEG, PNG, custom formats)
   ✓ Works as library AND CLI tool
   ✓ Pure Go (no CGO required)
   ✓ Excellent documentation
   ✓ Active community
   Cons:
   - Heavier than ledongthuc/pdf
   - More complex API
   Architecture: Dual-library approach
   - Keep ledongthuc/pdf for text (fast, proven)
   - Add pdfcpu for images (on-demand, lazy-loaded)
   - Zero impact on text extraction performance


2️⃣  GO-PDFIUM (NOT RECOMMENDED)
   Pros: Google's PDFium, accurate rendering
   Cons:
   ✗ Requires external C++ library OR WASM runtime
   ✗ Heavy/complex setup
   ✗ Over-engineered for simple extraction
   Verdict: Too heavy for MVP


3️⃣  UNIDOC UNIPDF (NOT RECOMMENDED)
   Pros: Most powerful PDF library, best text+image coordination
   Cons:
   ✗ AGPL/Commercial licensing (proprietary use requires license)
   ✗ Large (~2MB+)
   ✗ Licensing complexity
   Verdict: Unsuitable due to licensing


================================================================================
3. TERMINAL GRAPHICS OPTIONS (RANKED BY RECOMMENDATION)
================================================================================

1️⃣  GO-TERMIMG (RECOMMENDED)
   Status: ✓ Actively maintained
   License: Apache 2.0
   Size: +200KB
   Supported Protocols:
   ✓ Kitty (modern, best performance)
   ✓ iTerm2 (macOS native)
   ✓ SIXEL (legacy fallback)
   ✓ Halfblocks (Unicode fallback - works everywhere!)
   
   Features:
   ✓ Auto-detection of terminal capabilities
   ✓ Graceful fallback chain
   ✓ TUI integration (Bubbletea-compatible)
   ✓ Good documentation
   
   Terminal Coverage:
   Kitty → iTerm2 → SIXEL → Halfblocks = 99%+ terminals covered!


2️⃣  RASTERM (LIGHTWEIGHT ALTERNATIVE)
   Pros:
   ✓ Minimal size (~50KB)
   ✓ Lower-level (more control)
   Cons:
   ✗ No auto-fallback chain (manual protocol selection)
   ✗ No halfblocks fallback
   Verdict: OK for minimalist use, but go-termimg is better


================================================================================
4. RECOMMENDED ARCHITECTURE
================================================================================

APPROACH: Dual-Library Strategy

pkg/pdf/
├── document.go (Enhanced: lazy image loading)
├── image.go (NEW: Image types)
└── image_cache.go (NEW: LRU cache for images)

pkg/ui/
├── model.go (Enhanced: image state)
├── terminal.go (NEW: Terminal detection)
└── renderer.go (NEW: Image rendering)

Key Design Decisions:
✓ Keep ledongthuc/pdf for text (unchanged)
✓ Add pdfcpu for images (on-demand only)
✓ Lazy loading (zero startup overhead)
✓ Fallback chain: Kitty → iTerm2 → SIXEL → Halfblocks
✓ LRU image cache (10-50 images)
✓ Text placeholders for unsupported terminals


================================================================================
5. PHASE 3.1 MVP SCOPE (3-4 WEEKS)
================================================================================

GOAL: Get basic image support working on multiple terminals

✓ DELIVERABLES:
  - Add pdfcpu dependency
  - Implement ImageLRUCache
  - Terminal capability detection
  - Kitty protocol rendering
  - Image toggle keybinding (i)
  - Text fallback "[Image: 800x600]"
  - 30+ tests
  - Documentation

✗ NOT INCLUDED (Phase 3.2+):
  - SIXEL support (can add later)
  - Halfblocks rendering (can add later)
  - Image scaling UI
  - Advanced positioning
  - Copy/paste images
  - Image editing

SUCCESS CRITERIA:
✓ Images display in Kitty terminal
✓ Images display in iTerm2 (macOS)
✓ Text fallback works on unsupported terminals
✓ Performance: <200ms per page
✓ Cache hit rate: >80%
✓ Test coverage: >80%


================================================================================
6. TIMELINE & EFFORT
================================================================================

MVP (Phase 3.1): 3-4 weeks
├─ Week 1: Foundation (pdfcpu, cache, detection)
├─ Week 2: Rendering (go-termimg, protocols)
├─ Week 3: Integration (Document, Model, UI)
└─ Week 4: Polish (testing, docs, optimization)

Full Phase 3: 8-12 weeks total
├─ Phase 3.1: MVP (3-4 weeks)
├─ Phase 3.2: Advanced rendering (2-3 weeks) - SIXEL, Halfblocks, scaling
├─ Phase 3.3: Performance optimization (2 weeks)
└─ Phase 3.4: UI polish (2-3 weeks)


================================================================================
7. RISK ASSESSMENT
================================================================================

HIGH PRIORITY:
R1: Library integration (mitigation: dual-library, lazy loading)
R2: Terminal compatibility (mitigation: full fallback chain, 5+ terminal testing)
R3: Performance degradation (mitigation: lazy load, aggressive caching)
R4: Memory usage (mitigation: size-limited cache, profiling)

MEDIUM PRIORITY:
R5: Image format compatibility (mitigation: support JPEG/PNG/WebP, graceful fallback)
R6: PDF library licensing (mitigation: ✓ Apache 2.0 is commercial-friendly)

OVERALL RISK LEVEL: Medium (manageable with proper testing)


================================================================================
8. DEPENDENCY CHANGES
================================================================================

New go.mod dependencies:
  github.com/pdfcpu/pdfcpu v0.8.1+
  github.com/blacktop/go-termimg v0.9+

Binary Size Impact:
  Before: ~700KB
  After: ~1.2MB (+500KB, +71%)
  Still excellent (smaller than most Electron apps)

Build Impact:
  Pure Go compilation (no CGO)
  No external runtime dependencies
  Builds on all platforms


================================================================================
9. KEY DECISIONS
================================================================================

DECISION 1: Which PDF library?
CHOICE: pdfcpu for images + ledongthuc/pdf for text
RATIONALE:
✓ Dual-library keeps text path unchanged
✓ Apache 2.0 license (no commercial restrictions)
✓ Pragmatic: get something working quickly
✓ Can switch libraries later if needed
✓ Lazy loading minimizes performance impact

DECISION 2: Which terminal graphics?
CHOICE: go-termimg
RATIONALE:
✓ Best fallback chain (99%+ terminal coverage)
✓ Auto-detection (seamless experience)
✓ TUI-friendly (Bubbletea compatible)
✓ Graceful degradation (always works)

DECISION 3: MVP approach?
CHOICE: Phase 3.1 (4-week sprint for basic support)
RATIONALE:
✓ Get something working quickly
✓ Gather user feedback early
✓ Polish features in Phase 3.2+
✓ Production-ready in reasonable timeframe


================================================================================
10. COMPARISON TABLE
================================================================================

Aspect              | ledongthuc/pdf | pdfcpu | UniPDF | go-pdfium
--------------------|----------------|--------|--------|----------
Image Extraction    | ✗ None         | ✓ Yes  | ✓ Yes  | ✓ Via render
Text Extraction     | ✓ Fast         | ✓ Yes  | ✓ Yes  | ✓ Yes
Pure Go             | ✓ Yes          | ✓ Yes  | ✓ Yes  | ✗ Requires CGO/WASM
Size                | ~100KB         | ~500KB | ~2MB+  | Large+
License             | MIT            | Apache | AGPL   | MIT
Complexity          | ⭐ Low         | ⭐⭐   | ⭐⭐⭐ | ⭐⭐⭐
Recommended         | Keep for text  | Add    | NO     | NO


Terminal            | Kitty | iTerm2 | SIXEL | Halfblocks
--------------------|-------|--------|-------|----------
Kitty               | ✓     | -      | -     | ✓ fallback
iTerm2              | -     | ✓      | ✓ 3.3 | ✓ fallback
WezTerm             | ✓     | ✓      | ✓     | ✓ fallback
Ghostty             | ✓     | -      | -     | ✓ fallback
xterm               | -     | -      | ✓     | ✓ fallback
Alacritty           | -     | -      | -     | ✓ fallback
Coverage with fallback chain: 99%+


================================================================================
11. BOTTOM LINE RECOMMENDATIONS
================================================================================

✓ Phase 3 (Image Support) is FEASIBLE and RECOMMENDED

Quick Wins:
1. Use pdfcpu for image extraction (Apache 2.0, pure Go)
2. Use go-termimg for terminal rendering (best fallback chain)
3. Keep ledongthuc/pdf for text (proven, fast)
4. Implement lazy loading (on-demand images)
5. Start with MVP (3-4 weeks) before polishing

Architecture Benefits:
✓ Zero impact on text extraction performance
✓ Backward compatible (existing PDFs work unchanged)
✓ Graceful degradation (text fallback always works)
✓ Scalable (can add more terminals/features later)

Success Factors:
1. Comprehensive testing (5+ terminals)
2. Performance monitoring (benchmarks)
3. Graceful fallback chain (always works somewhere)
4. User configuration options (toggle images, scaling)
5. Clear documentation (keybindings, limitations)


================================================================================
DOCUMENT LOCATION
================================================================================

Full Analysis: /home/user/LUMOS/PHASE_3_IMAGE_SUPPORT_ANALYSIS.md (876 lines)

Sections:
1. PDF Image Extraction Analysis
2. Terminal Graphics Options Analysis
3. Integration Architecture (detailed code examples)
4. MVP Scope vs Full Phase 3
5. Implementation Timeline
6. Risk Assessment
7. Testing Strategy
8. Go Dependency Changes
9. Migration Path
10. Recommended Decision
11. Appendix with Code Comparisons


================================================================================
NEXT STEPS
================================================================================

1. Review analysis document
2. Discuss recommendations with team
3. If approved:
   a. Create PHASE_3_PLAN.md with detailed milestones
   b. Create issue/PR tracker for Phase 3.1
   c. Start Week 1: Foundation (pdfcpu integration)
4. Iterate based on feedback


================================================================================
END OF SUMMARY
================================================================================
